(window.officehome_pwa_webpackJsonp=window.officehome_pwa_webpackJsonp||[]).push([[125],{r8hs:function(e,i,t){"use strict";t.r(i),t.d(i,"UpsellButton",(function(){return d}));var r=t("mXGw"),s=t("xARA"),n=t("70cc"),a=t("y3b+"),c=t("BaAg"),o=r?class extends r.Component{constructor(e){super(e),this.props.installConfigService.config.dimeEnabled&&this.props.upsellDataService.warmupDime("gopremium"),this.launchDime=this.launchDime.bind(this)}render(){return"Start"!==this.props.route&&("MyForms"!==this.props.route||this.props.app!==c.b.Forms)||this.props.app!==c.b.Word&&this.props.app!==c.b.Excel&&this.props.app!==c.b.PowerPoint&&this.props.app!==c.b.Forms&&this.props.app!==c.b.FormsQuiz?null:(this.props.instrumentationService.logImpressionEvent("Upsell_Button_Impression"),r.createElement("a",{id:"upsell-button",style:{lineHeight:"normal"},className:"shell-upsell-button o365sx-button o365sx-highContrastButton",href:this.getHref(),target:this.getTarget(),onClick:this.launchDime,"aria-label":this.props.locService.FirstRunFreeConsumerGoPremium},r.createElement("span",{className:"shell-upsell-button__icon ms-ohp-Icon ms-ohp-Icon--diamond"}),this.props.minimized?null:r.createElement("span",{className:"shell-upsell-button__text"},this.props.locService.FirstRunFreeConsumerGoPremium)))}getHref(){return this.props.installConfigService.config.dimeEnabled?"#":this.getUrl()}getTarget(){return this.props.installConfigService.config.dimeEnabled?"":this.props.linkTarget}getUrl(){const e=this.props.upsellDataService.getUpsellTrackingParam();return this.props.installConfigService.config.shellGoPremiumUrl.replace("{OEM}",e).replace("{APP}",c.b[this.props.app])}launchDime(e){this.props.installConfigService.config.dimeEnabled&&(null==e||e.preventDefault(),this.props.upsellDataService.launchDime("gopremium",this.getUrl()))}}:()=>null,l=t("vSs+"),h=t("hhzZ"),p=t("6nG3"),m=t("hZW2"),u=t("PBJH");class d{constructor(e,i,t,r,s){this.consumerInstallConfigService=e,this.contextService=i,this.eventService=t,this.injector=r,this.officeRouteService=s,this.isFreeUser=!1,this.consumerInstallConfigService.getConfig().then((e=>{const i=e&&e.currentSkuInfo?e.currentSkuInfo.skuType:p.b.NotDetected;this.isFreeUser=i===p.b.NotSubscribed||i===p.b.NonActive,this.isFreeUser&&(this.subscribe(),this.eventService.whenEventFired("convertedToPaid",1).then((()=>{this.isFreeUser=!1;const e=this.injector.get(m.a),i=e.nativeDocument.getElementById("goPremium");i&&e.addCssClassToElement(i,"element-hidden")})))}))}unsubscribe(){this.routeChangeEndSubscription&&this.routeChangeEndSubscription.unsubscribe(),this.renderUpsellSubscription&&this.renderUpsellSubscription.unsubscribe()}subscribe(){this.renderUpsellSubscription=this.eventService.events.withScope(0).pipe(Object(n.a)((e=>"renderUpsellButton"===e.name))).subscribe((e=>{if(e.args.length){const i=0===e.args[0];i||1===e.args[0]||(this.container=e.args[0]),this.routeChangeEndSubscription=this.officeRouteService.subscribeToRouteChangeEnd((e=>{r&&this.isFreeUser&&s.render(r.createElement(o,{route:e.currentRoute.route,app:e.currentRoute.app,locService:this.injector.get(u.a),instrumentationService:this.injector.get(h.a),upsellDataService:this.injector.get(l.a),installConfigService:this.injector.get(a.a),linkTarget:this.contextService.sharedContext.defaultLinkTarget,minimized:i}),this.container)}))}}))}}},"vSs+":function(e,i,t){"use strict";t.d(i,"a",(function(){return f}));var r=t("70cc"),s=t("WKA6"),n=t("lrJm"),a=t("y3b+"),c=t("hhzZ"),o=t("hZW2"),l=t("7Gwk"),h=t("Uqr9"),p=t("casz"),m=t("TIi1"),u=t("4/We"),d=t("cgnd"),g=t("/I02"),v=t("pjz5"),S=t("Mlb/");class f{constructor(e,i,t,r,s,n,a,c,o,l,h){this.eventService=e,this.capabilitiesService=i,this.clientStartupConfigService=t,this.contextService=r,this.documentService=s,this.globalErrorHandler=n,this.installConfigService=a,this.instrumentationService=c,this.performanceService=o,this.schedulerService=l,this.urlLauncherService=h,this.upsellTrackingParam="",this.dimeDisabled=!1,this.preloadedExperiences=[]}getUpsellTrackingParam(){if(""!==this.upsellTrackingParam)return this.upsellTrackingParam;if(this.capabilitiesService.capabilities.isPwaInUwp){if(this.upsellTrackingParam="PWA",MyOffice.RuntimeComponents&&MyOffice.RuntimeComponents.ClientSystem)try{const e=MyOffice.RuntimeComponents.ClientSystem.getDeviceOEMIdentifier();this.upsellTrackingParam=`PWA-${e}`}catch(e){this.globalErrorHandler.handleError(e,"t90JZ")}["WordPad","CovidLockscreen","CovidStartMenu","CovidAMC","CovidActionCenter","HVAStartMenu"].forEach((e=>{this.checkOrigin(e)&&(this.upsellTrackingParam+="-"+e)}))}else this.upsellTrackingParam="HomePage",["RFMGraceToOnline","RFMGraceToOnline2","CovidLockscreen","CovidStartMenu","CovidAMC","CovidActionCenter","RFMSubExpB","RFMSubExpC","EduExp1","EduExp2","HVAStartMenu","MacWXPOO","GetGenuine","FreeOfframpFromDialog","FreeOfframpFromTBA","5DayPassEndedBizbar","GenericRFMBizbar"].forEach((e=>{this.checkOrigin(e)&&(this.upsellTrackingParam+="-"+(e.startsWith("RFM")?"RFM":e))}));return this.upsellTrackingParam}broadcastUpsell(){this.eventService.broadcastEvent({name:"premiumTemplatesUpsellStarted",args:[]})}warmupDime(e){this.clientStartupConfigService.config.authType!==d.a.MSA||this.capabilitiesService.capabilities.isPwaInUwp&&window.prelaunchMode||-1===this.preloadedExperiences.indexOf(e)&&(this.preloadedExperiences.push(e),this.logDimeEvent("Dime_Warmup",e),this.scheduleWarmupTask({experiences:[e]}))}launchDime(e,i,r){if(this.dimeDisabled)return this.capabilitiesService.capabilities.contentLauncherEnabled?Promise.all([t.e(0),t.e(1),t.e(2),t.e(3)]).then(t.bind(null,"DZQ9")).then((e=>{e.launchUrl(i,{action:"Upsell"})})):this.urlLauncherService.openUrl(i,"Upsell"),void this.logDimeEvent("Dime_Launch",e,"Failed","RedirectToPOC;DimeDisabled");let s=null;const n=this.loadDime(),a=new Promise((e=>{s=setTimeout((()=>{e(0)}),this.installConfigService.config.dimeTimeoutMs)}));return Promise.race([n,a]).then((n=>{if(s&&clearTimeout(s),1!==n)return this.dimeDisabled=!0,void this.logDimeEvent("Dime_Launch",e,"Failed","TimeOut");try{const t=this.getCampainIdFromTargetUrl(i),s={experience:e,campaignId:t};r&&(s.parentElementId=r),this.logDimeEvent("Dime_Launch",e,"Start"),this.eventService.broadcastEvent({name:"dimeUpsellDialogOpened",args:[]}),this.dime.launch(s,(()=>{this.logDimeEvent("DimeTransactionCompleted",e),this.eventService.broadcastEvent({name:"convertedToPaid",args:[]})})).then((i=>{this.logDimeEvent("Dime_Completed",e,i.status,i.metaData),this.eventService.broadcastEvent({name:"dimeUpsellDialogClosed",args:[]})}))}catch(r){this.dimeDisabled=!0,this.logDimeEvent("Dime_Launch",e,"Failed",r,"RedirectToPOC;LaunchException"),this.capabilitiesService.capabilities.contentLauncherEnabled?Promise.all([t.e(0),t.e(1),t.e(2),t.e(3)]).then(t.bind(null,"DZQ9")).then((e=>{e.launchUrl(i,{action:"Upsell"})})):this.urlLauncherService.openUrl(i,"Upsell")}}))}scheduleWarmupTask(e){return this.eventService.events.withScope(0).pipe(Object(r.a)((e=>"mruFailed"===e.name||"mruReady"===e.name)),Object(s.a)(1)).toPromise().then((()=>{this.schedulerService.scheduleWork((()=>{this.loadDime().then((i=>{1===i&&this.preloadDimeExperience(e)}))}),4)}))}loadDime(){return this.loadDimePromise||(this.performanceService.mark("LoadDimeScript_Started"),this.loadDimePromise=new Promise((e=>{this.documentService.addScriptToPage(this.installConfigService.config.dimeJSUrl,(()=>{this.logDimeEvent("Dime_LoadScript","","Succeeded"),this.performanceService.mark("LoadDimeScript_Completed"),this.initializeDime().then((()=>{e(1)})).catch((()=>{e(2)}))}),(()=>{this.logDimeEvent("Dime_LoadScript","","Failed"),e(2)}),!1,"dimeScript")}))),this.loadDimePromise}checkOrigin(e){return this.clientStartupConfigService.config.sharedClientStartupContext.requestOrigin.toLowerCase()===e.toLowerCase()}getCampainIdFromTargetUrl(e){if(e&&e.indexOf("ocid=")>0){const i=v.a.getLocation(e),t=v.a.getQueryParams(i.search);return""!==t.ocid?t.ocid:"PROD_OfficeCom"}return"PROD_OfficeCom"}initializeDime(){return new Promise(((e,i)=>{if(this.dime&&e(1),this.dimeDisabled&&e(2),"undefined"!=typeof Dime){this.performanceService.mark("DimeInitialize_Start");const t={partnerId:this.capabilitiesService.capabilities.pwaEnabled?"officepwa":"officedotcom",language:this.contextService.sharedContext.officeMarket,sessionId:this.clientStartupConfigService.config.sharedClientStartupContext.sessionId,authHint:this.capabilitiesService.capabilities.pwaEnabled?this.clientStartupConfigService.config.puid:this.clientStartupConfigService.config.userPrincipalName,userInfo:{puid:this.clientStartupConfigService.config.puid}};try{this.dime=new Dime(t),this.performanceService.mark("DimeInitialize_Complete"),this.logDimeEvent("Dime_Initialize","","Succeeded"),e(1)}catch(e){this.dimeDisabled=!0,this.logDimeEvent("Dime_Initialize","","Failed",e),i()}}else this.dimeDisabled=!0,this.logDimeEvent("Dime_Initialize","","Failed","Dime_Undefined"),i()}))}preloadDimeExperience(e){this.dime&&(this.performanceService.mark("DimePreload_Start"),this.logDimeEvent("Dime_Preload",e.experiences.toString(),"Start"),this.dime.preload(e).catch((i=>this.logDimeEvent("Dime_Preload",e.experiences.toString(),"Failed",i))))}logDimeEvent(e,i="",t="",r,s){const n={};n.DimeExperience=i,n.State=t;const a=s?s+";":"";n.DebugInfo="string"==typeof r?a+r:r?a+JSON.stringify(r):a,this.instrumentationService.logGenericEvent(e,n)}}f.Éµprov=S.cc({factory:function(){return new f(S.dc(l.a),S.dc(u.a),S.dc(d.b),S.dc(g.a),S.dc(o.a),S.dc(n.b),S.dc(a.a),S.dc(c.a),S.dc(h.b),S.dc(p.a),S.dc(m.a))},token:f,providedIn:"root"})}}]);
//# sourceMappingURL=pwa-125.625cad33f96ec63f92c7.chunk.v5.js.map